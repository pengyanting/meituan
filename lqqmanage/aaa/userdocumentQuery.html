<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../Css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../Css/bootstrap-responsive.css" />
    <link rel="stylesheet" type="text/css" href="../Css/style.css" />
    <script type="text/javascript" src="../Js/jquery2.js"></script>
    <script type="text/javascript" src="../Js/bootstrap.js"></script>
    <script type="text/javascript" src="../Js/ckform.js"></script>
    <script type="text/javascript" src="../Js/common.js"></script>
    <style type="text/css">
        body {
            font-size: 20px;
            padding-bottom: 40px;
            background-color: #e9e7ef;
        }
        
        .sidebar-nav {
            padding: 9px 0;
        }
        
        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }
    </style>
</head>

<body>
    <form class="form-inline definewidth m20" action="#" method="get">
        <font color="#777777"><strong>评论内容：</strong></font>
        <input type="text" name="content"  class="abc input-default" placeholder="" value="">&nbsp;&nbsp;
        <font color="#777777"><strong>用户名称：</strong></font>
        <input type="text" name="username"  class="abc input-default" placeholder="" value="">&nbsp;&nbsp;
        <button type="button" class="btn btn-primary">查询</button>
    </form>
    <table class="table table-bordered table-hover definewidth m10">
        <thead>
            <tr>
                <th>序号</th>
                <th>用户名</th>
                <th>用户ID</th>
                <th>评论内容</th>
                <th>上传日期</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody class='tableList'></tbody>
    </table>
</body>
<script>
    $(function () {
        //查询所有评论
        var sql = "select * from pinglun where 1=1 "
        function query(sql) {
            $.ajax({
                type: 'POST',
                url: "../php/user/selectUser.php",
                dataType: "json",
                data: {
                    sql: sql
                },
                success: function (data) {
                    if (data.length > 0) {
                        var str = "";
                        for (var i = 0; i < data.length; i++) {
                            str += "<tr>" +
                                "<td>" + data[i].id + "</td>" +
                                "<td>" + data[i].username + "</td>" +
                                "<td>" + data[i].userid + "</td>" +
                                "<td>" + data[i].content + "</td>" +
                                "<td>" + data[i].time + "</td>" +
                                "<td id='" + data[i].id + "' class='del'><button type='button'>删除</button></td>" +
                                "</tr>"
                        }
                        $(".tableList").html(str)
                    } else {
                        alert('无查询结果！')
                    }
                },
                error: function (error) {
                    alert('查询失败！')
                }
            });
        }
        query(sql);
        //删除用户
        $('.tableList').on('click', '.del', function () {
            var id = $(this).attr('id');
            $.ajax({
                type: 'POST',
                url: "../php/del.php",
                dataType: "json",
                data: {
                    id: id,
                    deltype: 'pinglun'
                },
                success: function (data) {
                    alert('删除成功！')
                    query(sql)
                },
                error: function (error) {
                    alert('删除失败！')
                }
            });
        })
        //筛选
        $('.btn-primary').click(function () {
            var content = $('input[name=content]').val();
            var username = $('input[name=username]').val();
            sql = "select * from pinglun where 1=1 "
            if (content) {
                sql += "and content like '%" + content + "%' "
            }
            if (username) {
                sql += "and username like '%" + username + "%' "
            }
            query(sql);
        })
    })

</script>

</html>